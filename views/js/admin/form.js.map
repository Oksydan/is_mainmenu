{"version":3,"file":"js/admin/form.js","mappings":"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","sources":["webpack://is_mainmenu_admin/./src/js/components/useAutocomplete.js","webpack://is_mainmenu_admin/./src/js/utils/eventPrestashopComponentsReady.js","webpack://is_mainmenu_admin/./src/js/form.js"],"sourcesContent":["export const parseToHtml = (str) => {\n  const parser = new DOMParser();\n  const doc = parser.parseFromString(str, 'text/html');\n\n  return doc.body.children[0];\n};\n\nconst useAutocomplete = (input, appendTo, formatResult, onSearch, onSelect, options = {}) => {\n  let timeoutId;\n  const opt = {\n    timeout: 300,\n    minChars: 3,\n    ...options,\n  };\n  const { timeout, minChars } = opt;\n  let open = false;\n\n  const buildAutocompleteContent = (resultArray, value) => {\n    const resultNodes = resultArray\n      .map((item) => {\n        const string = formatResult(item);\n        const node = parseToHtml(string);\n\n        node.addEventListener('click', onSelect);\n\n        return node;\n      });\n\n    const wrapper = document.createElement('div');\n    wrapper.classList.add('menu-product-autocomplete');\n\n    resultNodes.forEach((item) => {\n      wrapper.appendChild(item);\n    });\n\n    if (resultNodes.length === 0) {\n      const node = document.createElement('div');\n      node.classList.add('m-3', 'alert', 'alert-warning');\n      node.innerText = `No results found for ${value}`;\n\n      wrapper.appendChild(node);\n    }\n\n    return wrapper;\n  };\n\n  const close = () => {\n    appendTo.innerHTML = '';\n\n    // eslint-disable-next-line no-use-before-define\n    closeAutocomplete();\n  };\n\n  const handleDocumentClick = (e) => {\n    const { target } = e;\n    const isInput = target === input;\n\n    if (isInput) {\n      return;\n    }\n\n    close();\n  };\n\n  const closeAutocomplete = () => {\n    open = false;\n    document.removeEventListener('click', handleDocumentClick);\n  };\n\n  const openAutocomplete = () => {\n    document.addEventListener('click', handleDocumentClick);\n  };\n\n  const setAutocompletePosition = (content) => {\n    const { height } = input.getBoundingClientRect();\n    content.style.top = `${height}px`;\n  };\n\n  const handleKeyUp = (e) => {\n    if (timeoutId) {\n      clearTimeout(timeoutId);\n    }\n    const { target } = e;\n    const { value } = target;\n\n    if (value.length < minChars) {\n      close();\n      return;\n    }\n\n    timeoutId = setTimeout(async () => {\n      const result = await onSearch(value);\n      const content = buildAutocompleteContent(result, value);\n      setAutocompletePosition(content);\n\n      appendTo.replaceChildren(content);\n\n      if (!open) {\n        open = true;\n        openAutocomplete();\n      }\n    }, timeout);\n  };\n\n  const destroy = () => {\n    input.removeEventListener('keyup', handleKeyUp);\n    close();\n  };\n\n  const init = () => {\n    input.addEventListener('keyup', handleKeyUp);\n  };\n\n  return {\n    close,\n    destroy,\n    init,\n  };\n};\n\nexport default useAutocomplete;\n","let callNumber = 0;\nconst callLimit = 20;\n\nconst eventPrestashopComponentsReady = () => {\n  const checkComponentsReady = () => {\n    if (callNumber >= callLimit) {\n      return;\n    }\n\n    callNumber += 1;\n\n    if (!(window?.prestashop?.component)) {\n      setTimeout(checkComponentsReady, 100);\n    } else {\n      const event = new Event('PrestashopComponentsReady');\n      document.dispatchEvent(event);\n    }\n  };\n\n  document.addEventListener('DOMContentLoaded', checkComponentsReady);\n\n  const onComponentsReady = (callback) => {\n    document.addEventListener('PrestashopComponentsReady', callback);\n  }\n\n  return {\n    onComponentsReady\n  }\n}\n\nexport default eventPrestashopComponentsReady;\n","import useAutocomplete from './components/useAutocomplete';\nimport eventPrestashopComponentsReady from './utils/eventPrestashopComponentsReady';\n\nconst { onComponentsReady } = eventPrestashopComponentsReady();\n\n\nconst initAutoComplete = () => {\n  const input = document.querySelector('#menu_element_product_product_query');\n  const idProductInput = document.querySelector('#menu_element_product_id_product');\n  const idProductAttributeInput = document.querySelector('#menu_element_product_id_product_attribute');\n  const appendToElement = document.querySelector('.js-autocomplete-product-result');\n  const selectedElement = document.querySelector('.js-autocomplete-product-selected');\n\n  if (!input || !appendToElement || !selectedElement) {\n    return;\n  }\n\n  const formatResult = (item) => `\n      <div\n      class=\"menu-product-autocomplete__item\"\n      data-name=\"${item.name}\"\n      data-id-product=\"${item.id_product}\"\n      data-id-product-attribute=\"${item.id_product_attribute}\"\n      >\n        ${item.image ? `<img class=\"menu-product-autocomplete__image\" src=\"${item.image}\" />` : ''}\n        <div class=\"menu-product-autocomplete__name\">\n          ${item.name}\n        </div>\n      </div>\n    `;\n  const onSearch = async (query) => {\n    const url = input.dataset.autocompleteUrl;\n\n    return fetch(url, {\n      method: 'POST',\n      headers: {\n        accept: 'application/json',\n        'Content-Type': 'application/x-www-form-urlencoded; charset=UTF-8',\n        'X-Requested-With': 'XMLHttpRequest',\n      },\n      body: `q=${encodeURIComponent(query)}`,\n    })\n      .then((response) => response.json());\n  };\n\n  const getSelectedProductTemplate = async (idProduct, idProductAttribute) => {\n    const url = input.dataset.selectedProductUrl;\n\n    return fetch(url, {\n      method: 'POST',\n      headers: {\n        accept: 'application/json',\n        'Content-Type': 'application/x-www-form-urlencoded; charset=UTF-8',\n        'X-Requested-With': 'XMLHttpRequest',\n      },\n      body: `id_product=${encodeURIComponent(idProduct)}&id_product_attribute=${encodeURIComponent(idProductAttribute)}`,\n    })\n      .then((response) => response.json());\n  };\n\n  const onSelect = async (e) => {\n    const { currentTarget } = e;\n    const idProduct = currentTarget.getAttribute('data-id-product');\n    const idProductAttribute = currentTarget.getAttribute('data-id-product-attribute');\n\n    idProductInput.value = idProduct;\n    idProductAttributeInput.value = idProductAttribute;\n    input.value = '';\n    const selectedProduct = await getSelectedProductTemplate(idProduct, idProductAttribute);\n\n    selectedElement.innerHTML = selectedProduct.content;\n    // eslint-disable-next-line no-use-before-define\n    close();\n  };\n\n  const {\n    close,\n    init,\n  } = useAutocomplete(\n    input,\n    appendToElement,\n    formatResult,\n    onSearch,\n    onSelect,\n  );\n\n  init();\n};\n\nconst initFormComponents = () => {\n  window.prestashop.component.initComponents(\n    [\n      'TranslatableField',\n      'TinyMCEEditor',\n      'TranslatableInput',\n    ],\n  );\n\n  const choiceTree = new window.prestashop.component.ChoiceTree('.js-choice-tree-container');\n\n  choiceTree.enableAutoCheckChildren();\n};\n\nonComponentsReady(() => {\n  initFormComponents();\n  initAutoComplete();\n});\n"],"names":["parseToHtml","str","input","appendTo","formatResult","onSearch","onSelect","options","timeoutId","opt","timeout","minChars","open","buildAutocompleteContent","resultArray","value","resultNodes","item","string","node","wrapper","close","closeAutocomplete","handleDocumentClick","e","target","openAutocomplete","setAutocompletePosition","content","height","handleKeyUp","result","callNumber","callLimit","checkComponentsReady","event","callback","onComponentsReady","initAutoComplete","idProductInput","idProductAttributeInput","appendToElement","selectedElement","query","url","response","getSelectedProductTemplate","idProduct","idProductAttribute","currentTarget","selectedProduct","init","initFormComponents"],"sourceRoot":""}