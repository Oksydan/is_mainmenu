{"version":3,"file":"js/admin/form.js","mappings":"8jBAAO,MAAMA,EAAeC,GACX,IAAI,UAAU,EACV,gBAAgBA,EAAK,WAAW,EAExC,KAAK,SAAS,CAAC,EAkH5B,EA/GwB,CAACC,EAAOC,EAAUC,EAAcC,EAAUC,EAAUC,EAAU,CAAC,IAAM,CAC3F,IAAIC,EACJ,MAAMC,EAAM,GACV,QAAS,IACT,SAAU,GACPF,CAAO,EAEN,CAAE,QAAAG,EAAS,SAAAC,CAAS,EAAIF,EAC9B,IAAIG,EAAO,GAEX,MAAMC,EAA2B,CAACC,EAAaC,IAAU,CACvD,MAAMC,EAAcF,EACjB,IAAKG,GAAS,CACb,MAAMC,EAASd,EAAaa,CAAI,EAC1BE,EAAOnB,EAAYkB,CAAM,EAE/B,OAAAC,EAAK,iBAAiB,QAASb,CAAQ,EAEhCa,CACT,CAAC,EAEGC,EAAU,SAAS,cAAc,KAAK,EAO5C,GANAA,EAAQ,UAAU,IAAI,2BAA2B,EAEjDJ,EAAY,QAASC,GAAS,CAC5BG,EAAQ,YAAYH,CAAI,CAC1B,CAAC,EAEGD,EAAY,SAAW,EAAG,CAC5B,MAAMG,EAAO,SAAS,cAAc,KAAK,EACzCA,EAAK,UAAU,IAAI,MAAO,QAAS,eAAe,EAClDA,EAAK,UAAY,wBAA0BJ,EAE3CK,EAAQ,YAAYD,CAAI,CAC1B,CAEA,OAAOC,CACT,EAEMC,EAAuBC,GAAM,CACjC,KAAM,CAAE,OAAAC,CAAO,EAAID,EACHC,IAAWrB,GAM3BsB,EAAM,CACR,EAEMC,EAAmB,IAAM,CAC7B,SAAS,iBAAiB,QAASJ,CAAmB,CACxD,EAEMK,EAAoB,IAAM,CAC9Bd,EAAO,GACP,SAAS,oBAAoB,QAASS,CAAmB,CAC3D,EAEMG,EAAQ,IAAM,CAClBrB,EAAS,UAAY,GACrBuB,EAAkB,CACpB,EAEMC,EAAU,IAAM,CACpBzB,EAAM,oBAAoB,QAAS0B,CAAW,EAC9CJ,EAAM,CACR,EAEMK,EAA2BC,GAAY,CAC3C,KAAM,CAAE,OAAAC,CAAO,EAAI7B,EAAM,sBAAsB,EAC/C4B,EAAQ,MAAM,IAAMC,EAAS,IAC/B,EAEMH,EAAeN,GAAM,CACrBd,GACF,aAAaA,CAAS,EAExB,KAAM,CAAE,OAAAe,CAAO,EAAID,EACb,CAAE,MAAAP,CAAM,EAAIQ,EAElB,GAAIR,EAAM,OAASJ,EAAU,CAC3Ba,EAAM,EACN,MACF,CAEAhB,EAAY,WAAW,IAAY,0BACjC,MAAMwB,EAAS,MAAM3B,EAASU,CAAK,EAC7Be,EAAUjB,EAAyBmB,EAAQjB,CAAK,EACtDc,EAAwBC,CAAO,EAE/B3B,EAAS,gBAAgB2B,CAAO,EAE3BlB,IACHA,EAAO,GACPa,EAAiB,EAErB,CAAC,EAAEf,CAAO,CACZ,EAMA,MAAO,CACL,MAAAc,EACA,QAAAG,EACA,KAPW,IAAM,CACjBzB,EAAM,iBAAiB,QAAS0B,CAAW,CAC7C,CAMA,CACF,E,6MClHA,MAAMK,EAAmB,IAAM,CAC7B,MAAM/B,EAAQ,SAAS,cAAc,qCAAqC,EACpEgC,EAAmB,SAAS,cAAc,kCAAkC,EAC5EC,EAA6B,SAAS,cAAc,4CAA4C,EAChGC,EAAkB,SAAS,cAAc,iCAAiC,EAC1EC,EAAkB,SAAS,cAAc,mCAAmC,EAE5EjC,EAAgBa,GACb;AAAA;AAAA;AAAA,mBAGQA,EAAK,IAAI;AAAA,yBACHA,EAAK,UAAU;AAAA,mCACLA,EAAK,oBAAoB;AAAA;AAAA,UAElDA,EAAK,MAAQ,sDAAsDA,EAAK,KAAK,OAAS,EAAE;AAAA;AAAA,YAEtFA,EAAK,IAAI;AAAA;AAAA;AAAA,MAKbZ,EAAkBiC,GAAU,0BAChC,MAAMC,EAAMrC,EAAM,QAAQ,gBAE1B,OAAO,MAAM,MAAMqC,EAAK,CACtB,OAAQ,OACR,QAAS,CACP,OAAQ,mBACR,eAAgB,mDAChB,mBAAoB,gBACtB,EACA,KAAM,KAAO,mBAAmBD,CAAK,CACvC,CAAC,EACA,KAAME,GAAaA,EAAS,KAAK,CAAC,CACrC,CAAC,EAEKC,EAA6B,CAAOC,EAAYC,IAAyB,0BAC7E,MAAMJ,EAAMrC,EAAM,QAAQ,mBAE1B,OAAO,MAAM,MAAMqC,EAAK,CACtB,OAAQ,OACR,QAAS,CACP,OAAQ,mBACR,eAAgB,mDAChB,mBAAoB,gBACtB,EACA,KAAM,cAAgB,mBAAmBG,CAAU,EAAI,yBAA2B,mBAAmBC,CAAoB,CAC3H,CAAC,EACE,KAAMH,GAAaA,EAAS,KAAK,CAAC,CACvC,CAAC,EAEKlC,EAAkBgB,GAAM,0BAC5B,KAAM,CAAE,cAAAsB,CAAc,EAAItB,EACpBoB,EAAaE,EAAc,aAAa,iBAAiB,EACzDD,EAAuBC,EAAc,aAAa,2BAA2B,EAEnFV,EAAiB,MAAQQ,EACzBP,EAA2B,MAAQQ,EACnCzC,EAAM,MAAQ,GACd,MAAM2C,EAAkB,MAAMJ,EAA2BC,EAAYC,CAAoB,EAEzFN,EAAgB,UAAYQ,EAAgB,QAC5CrB,EAAM,CACR,CAAC,EAEK,CACJ,MAAAA,EACA,KAAAsB,CACF,EAAI,EACF5C,EACAkC,EACAhC,EACAC,EACAC,CACF,EAEAwC,EAAK,CACP,EAEMC,EAAqB,IAAM,CAC/B,QAAQ,IAAI,OAAO,UAAU,EAC7B,OAAO,WAAW,UAAU,eAC1B,CACE,oBACA,gBACA,mBACF,CACF,EAEmB,IAAI,OAAO,WAAW,UAAU,WAAW,2BAA2B,EAE9E,wBAAwB,CACrC,EAEA,IAAIC,EAAa,EACjB,MAAMC,EAAY,GACZC,EAAuB,IAAM,CAnGnC,MAoGE,GAAI,EAAAF,GAAcC,GAKlB,GADAD,IACI,GAAE,6BAAQ,aAAR,QAAoB,WACxB,WAAWE,EAAsB,GAAG,MAC/B,CACL,MAAMC,EAAQ,IAAI,MAAM,2BAA2B,EACnD,SAAS,cAAcA,CAAK,CAC9B,CACF,EAEA,SAAS,iBAAiB,mBAAoBD,CAAoB,EAElE,SAAS,iBAAiB,4BAA6B,IAAM,CAC3DH,EAAmB,EACnBd,EAAiB,CACnB,CAAC,C","sources":["webpack://is_mainmenu_admin/./src/js/components/useAutocomplete.js","webpack://is_mainmenu_admin/./src/js/form.js"],"sourcesContent":["export const parseToHtml = (str) => {\n  const parser = new DOMParser();\n  const doc = parser.parseFromString(str, 'text/html');\n\n  return doc.body.children[0];\n};\n\nconst useAutocomplete = (input, appendTo, formatResult, onSearch, onSelect, options = {}) => {\n  let timeoutId;\n  const opt = {\n    timeout: 300,\n    minChars: 3,\n    ...options,\n  }\n  const { timeout, minChars } = opt;\n  let open = false;\n\n  const buildAutocompleteContent = (resultArray, value) => {\n    const resultNodes = resultArray\n      .map((item) => {\n        const string = formatResult(item);\n        const node = parseToHtml(string);\n\n        node.addEventListener('click', onSelect);\n\n        return node;\n      });\n\n    const wrapper = document.createElement('div');\n    wrapper.classList.add('menu-product-autocomplete');\n\n    resultNodes.forEach((item) => {\n      wrapper.appendChild(item);\n    });\n\n    if (resultNodes.length === 0) {\n      const node = document.createElement('div');\n      node.classList.add('m-3', 'alert', 'alert-warning');\n      node.innerText = 'No results found for ' + value;\n\n      wrapper.appendChild(node);\n    }\n\n    return wrapper;\n  }\n\n  const handleDocumentClick = (e) => {\n    const { target } = e;\n    const isInput = target === input;\n\n    if (isInput) {\n      return;\n    }\n\n    close();\n  }\n\n  const openAutocomplete = () => {\n    document.addEventListener('click', handleDocumentClick);\n  }\n\n  const closeAutocomplete = () => {\n    open = false;\n    document.removeEventListener('click', handleDocumentClick);\n  }\n\n  const close = () => {\n    appendTo.innerHTML = '';\n    closeAutocomplete();\n  }\n\n  const destroy = () => {\n    input.removeEventListener('keyup', handleKeyUp);\n    close();\n  }\n\n  const setAutocompletePosition = (content) => {\n    const { height } = input.getBoundingClientRect();\n    content.style.top = height + 'px';\n  }\n\n  const handleKeyUp = (e) => {\n    if (timeoutId) {\n      clearTimeout(timeoutId);\n    }\n    const { target } = e;\n    const { value } = target;\n\n    if (value.length < minChars) {\n      close();\n      return;\n    }\n\n    timeoutId = setTimeout(async () => {\n      const result = await onSearch(value);\n      const content = buildAutocompleteContent(result, value);\n      setAutocompletePosition(content);\n\n      appendTo.replaceChildren(content);\n\n      if (!open) {\n        open = true;\n        openAutocomplete();\n      }\n    }, timeout)\n  }\n\n  const init = () => {\n    input.addEventListener('keyup', handleKeyUp);\n  }\n\n  return {\n    close,\n    destroy,\n    init,\n  }\n}\n\nexport default useAutocomplete;\n","import useAutocomplete from './components/useAutocomplete';\n\nconst initAutoComplete = () => {\n  const input = document.querySelector('#menu_element_product_product_query');\n  const id_product_input = document.querySelector('#menu_element_product_id_product');\n  const id_product_attribute_input = document.querySelector('#menu_element_product_id_product_attribute');\n  const appendToElement = document.querySelector('.js-autocomplete-product-result');\n  const selectedElement = document.querySelector('.js-autocomplete-product-selected');\n\n  const formatResult = (item) => {\n    return `\n      <div\n      class=\"menu-product-autocomplete__item\"\n      data-name=\"${item.name}\"\n      data-id-product=\"${item.id_product}\"\n      data-id-product-attribute=\"${item.id_product_attribute}\"\n      >\n        ${item.image ? `<img class=\"menu-product-autocomplete__image\" src=\"${item.image}\" />` : ''}\n        <div class=\"menu-product-autocomplete__name\">\n          ${item.name}\n        </div>\n      </div>\n    `;\n  };\n  const onSearch = async (query) => {\n    const url = input.dataset.autocompleteUrl;\n\n    return await fetch(url, {\n      method: 'POST',\n      headers: {\n        accept: 'application/json',\n        'Content-Type': 'application/x-www-form-urlencoded; charset=UTF-8',\n        'X-Requested-With': 'XMLHttpRequest'\n      },\n      body: 'q=' + encodeURIComponent(query),\n    })\n    .then((response) => response.json())\n  };\n\n  const getSelectedProductTemplate = async (id_product, id_product_attribute) => {\n    const url = input.dataset.selectedProductUrl;\n\n    return await fetch(url, {\n      method: 'POST',\n      headers: {\n        accept: 'application/json',\n        'Content-Type': 'application/x-www-form-urlencoded; charset=UTF-8',\n        'X-Requested-With': 'XMLHttpRequest'\n      },\n      body: 'id_product=' + encodeURIComponent(id_product) + '&id_product_attribute=' + encodeURIComponent(id_product_attribute),\n    })\n      .then((response) => response.json())\n  }\n\n  const onSelect = async (e) => {\n    const { currentTarget } = e;\n    const id_product = currentTarget.getAttribute('data-id-product');\n    const id_product_attribute = currentTarget.getAttribute('data-id-product-attribute');\n\n    id_product_input.value = id_product;\n    id_product_attribute_input.value = id_product_attribute;\n    input.value = '';\n    const selectedProduct = await getSelectedProductTemplate(id_product, id_product_attribute);\n\n    selectedElement.innerHTML = selectedProduct.content;\n    close();\n  };\n\n  const {\n    close,\n    init,\n  } = useAutocomplete(\n    input,\n    appendToElement,\n    formatResult,\n    onSearch,\n    onSelect,\n  );\n\n  init();\n}\n\nconst initFormComponents = () => {\n  console.log(window.prestashop);\n  window.prestashop.component.initComponents(\n    [\n      'TranslatableField',\n      'TinyMCEEditor',\n      'TranslatableInput',\n    ],\n  );\n\n  const choiceTree = new window.prestashop.component.ChoiceTree('.js-choice-tree-container');\n\n  choiceTree.enableAutoCheckChildren();\n}\n\nlet callNumber = 0;\nconst callLimit = 20;\nconst checkComponentsReady = () => {\n  if (callNumber >= callLimit) {\n    return;\n  }\n\n  callNumber++;\n  if (!(window?.prestashop?.component)) {\n    setTimeout(checkComponentsReady, 100)\n  } else {\n    const event = new Event('PrestashopComponentsReady');\n    document.dispatchEvent(event);\n  }\n}\n\ndocument.addEventListener('DOMContentLoaded', checkComponentsReady);\n\ndocument.addEventListener('PrestashopComponentsReady', () => {\n  initFormComponents();\n  initAutoComplete();\n});\n\n"],"names":["parseToHtml","str","input","appendTo","formatResult","onSearch","onSelect","options","timeoutId","opt","timeout","minChars","open","buildAutocompleteContent","resultArray","value","resultNodes","item","string","node","wrapper","handleDocumentClick","e","target","close","openAutocomplete","closeAutocomplete","destroy","handleKeyUp","setAutocompletePosition","content","height","result","initAutoComplete","id_product_input","id_product_attribute_input","appendToElement","selectedElement","query","url","response","getSelectedProductTemplate","id_product","id_product_attribute","currentTarget","selectedProduct","init","initFormComponents","callNumber","callLimit","checkComponentsReady","event"],"sourceRoot":""}